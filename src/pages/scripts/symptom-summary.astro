---
import fs from 'fs';
import path from 'path';
import yaml from 'js-yaml';

const filePath = path.resolve('./src/content/scripts/symptom-summary.yaml');

let script;

try {
  const fileContents = fs.readFileSync(filePath, 'utf8');
  script = yaml.load(fileContents);
  console.log("✅ SCRIPT:", script);
} catch (err) {
  console.error("❌ ERROR loading YAML:", err);
}
---
<html>
  <head>
    <title>{script.title}</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 2rem;
        max-width: 600px;
        margin: auto;
      }
      textarea {
        width: 100%;
        height: 8rem;
        margin-top: 0.5rem;
        margin-bottom: 1.5rem;
      }
      input, button {
        margin-top: 0.5rem;
        margin-bottom: 1rem;
        width: 100%;
        padding: 0.5rem;
      }
      .preview {
        white-space: pre-wrap;
        background: #f7f7f7;
        border: 1px solid #ddd;
        padding: 1rem;
        border-radius: 6px;
      }
    </style>
  </head>
  <body>
    <h1>{script.title}</h1>
    <p>{script.description}</p>

    <form id="script-form">
      {script.fields.map(field => (
        <div>
          <label for={field.name}>{field.label}</label>
          <textarea name={field.name} id={field.name}></textarea>
        </div>
      ))}
      <button type="button" onclick="generateOutput()">Generate</button>
    </form>

    <h2>Preview</h2>
    <div class="preview" id="output"></div>

    <script id="template-data" type="text/plain">
{script.template}
    </script>

    <script>
      const form = document.getElementById('script-form');

      function generateOutput() {
        const data = {};
        [...form.elements].forEach(el => {
          if (el.name) data[el.name] = el.value;
        });

        const template = document.getElementById('template-data').textContent;
        const output = template.replace(/{{(.*?)}}/g, (_, key) => data[key.trim()] || '');
        document.getElementById('output').textContent = output;
      }
    </script>
  </body>
</html>
