---
import fs from 'fs';
import path from 'path';
import yaml from 'js-yaml';

const filePath = path.resolve('./src/content/scripts/symptom-summary.yaml');
const fileContents = fs.readFileSync(filePath, 'utf8');
const script = yaml.load(fileContents);
---
<html>
  <head>
    <title>{script.title}</title>
    <meta charset="UTF-8" />
    <style>
      body {
        font-family: 'Segoe UI', system-ui, sans-serif;
        padding: 2rem;
        max-width: 700px;
        margin: auto;
        background-color: #fdfcf9; /* soft beige background */
        color: #222;
      }

      h1, h2, h3 {
        font-family: 'Segoe UI', system-ui, sans-serif;
        font-weight: 700;
        color: #222;
        line-height: 1.3;
        margin-bottom: 0.25rem;
      }

      .form-container {
        background: #fff6f1;
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        margin-top: 1rem;
      }

      textarea, input {
        width: 100%;
        margin-top: 0.25rem;
        margin-bottom: 1rem;
        padding: 0.5rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      button {
        padding: 0.75rem;
        font-size: 1rem;
        background: #4a5568;
        color: #fff;
        border: none;
        border-radius: 5px;
        margin-top: 1rem;
        cursor: pointer;
      }

      button:hover {
        background: #2d3748;
      }

      .preview {
        margin-top: 0.5rem;
        margin-bottom: 1rem;
        white-space: pre-wrap;
        background: #f9f9f9;
        border: 1px solid #ccc;
        padding: 1.5rem;
        border-radius: 6px;
        line-height: 1.6;
        font-family: Georgia, serif;
        font-size: 1.1rem;
        position: relative;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
      }
      label {
        font-size: 1.05rem;
        font-weight: 600;
        color: #333;
        text-shadow: 0 1px 0 #fff;
      }

    </style>
  </head>
  <body>
    <h1>{script.title}</h1>
    <p>{script.description}</p>

    <section class="form-container">
      <form id="script-form">
        {script.fields.map(field => (
          <div>
            <label for={field.name}><strong>{field.label}</strong></label>
            <textarea name={field.name} id={field.name}></textarea>
          </div>
        ))}
        <button type="button" id="generate-btn">Generate</button>
      </form>
    </section>

    <h2>Preview</h2>
    <p style="margin-top: -0.25rem; color: #555; font-size: 1rem;">
      You can copy, print, or hand this to your provider ‚Äî whatever works best.
    </p>
    <h3 style="font-size: 1.1rem; margin-top: 1rem; margin-bottom: 0.25rem;">
      üìù Generated Summary
    </h3>
    <div class="preview" id="output">(Fill out the form and click Generate)</div>

    <button type="button" id="copy-btn" style="margin-top: 0.75rem;">Copy to Clipboard</button>
    <button type="button" id="print-btn" style="margin-top: 0.25rem;">Print This</button>

    <script id="template-data" type="text/plain" set:html={script.template} />

    <script type="module">
      // Generate button logic
      function generateOutput() {
        const form = document.getElementById('script-form');
        const data = {};
        [...form.elements].forEach(el => {
          if (el.name) data[el.name] = el.value;
        });

        const template = document.getElementById('template-data').textContent;
        const output = template.replace(/{{(.*?)}}/g, (_, key) => data[key.trim()] || '');
        document.getElementById('output').textContent = output;
      }

      document.getElementById('generate-btn').addEventListener('click', generateOutput);

      // Copy to Clipboard logic
      document.getElementById('copy-btn').addEventListener('click', () => {
        const text = document.getElementById('output').textContent;
        navigator.clipboard.writeText(text).then(() => {
          alert('Copied to clipboard!');
        });
      });

      // Print logic
      document.getElementById('print-btn').addEventListener('click', () => {
        const content = document.getElementById('output').textContent;
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
          <pre style="font-family: Georgia, serif; font-size: 1rem; white-space: pre-wrap;">${content}</pre>
        `);
        printWindow.document.close();
        printWindow.print();
      });
    </script>
  </body>
</html>
